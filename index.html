<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <script src="https://unpkg.com/vue@next"></script>    
    
    <!-- Load required Bootstrap and BootstrapVue CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    
    <script src="https://cdn.plot.ly/plotly-2.4.2.min.js"></script>

  <body>

    <div class="row">
      <div class="col-1"></div>
      <div class="col-10">
        <div id="app">
          <div id="mydiv" ref="mydiv"></div>
          <form>
            <div class="row">
                <div class="form-group col-3">
                  <label for="grid-num">Grid Number</label>
                  <input id="grid-num" type="text" class="form-control" v-model="gridNum" @change="modifyData">
                </div>
                <div class="form-group col-3">
                  <label for="grid-res">Grid Resolution</label>
                  <input id="grid-res" type="text" class="form-control" v-model="gridRes" @change="modifyData">
                </div>
            </div>
          </form>
        </div>
      </div>
      <div class="col-1"></div>
    </div>
    <script>
      function genPressureField( gridNum, gridRes ){
      
        var initZV = new Array();//= new Array(gridNum).fill(0).map(function(){new Array(gridNum).fill(0)});
        var initXV = new Array(gridNum).fill(0);
        var initYV = new Array(gridNum).fill(0);
        for(var i=0;i<gridNum;i++){
          initZV[i] = new Array();
          for(var j=0;j<gridNum;j++){
            initZV[i][j] = 0;
          }
        }              
        //console.log(initZV[0]);

        for(var i=0;i<gridNum;i++){
          for(var j=0;j<gridNum;j++){
            initZV[i][j]  = gridRes * gridRes * ( i - gridNum/2 ) * ( i - gridNum/2 ) ;
            initZV[i][j] += gridRes * gridRes * ( j - gridNum/2 ) * ( j - gridNum/2 ) ;
            initZV[i][j]  = Math.sqrt(initZV[i][j]) / gridNum  / gridRes ;
            initZV[i][j]  = 1040 - initZV[i][j] * 60 ;
            initXV[i] = gridRes * i / 1000;
            initYV[j] = gridRes * j / 1000;
          }
        }    
        var initData = [{
          x : initXV,
          y : initYV,
          z : initZV,
          type: 'contour',
          colorscale: 'heatmap',
          contours: {
            coloring: 'lines',
            showlabels: true,
            labelfont: {
              family: 'Raleway',
              size: 12,
              color: 'black',
            }
          }        
        }]
        return initData;
      }
      
      // Vue 3.0 with Composition API Style
      const { createApp, ref } = Vue;

      const vm = createApp({
        data(){
          return {
            <!-- drawData :  [{ -->
              <!-- x: [1, 2, 3, 5], -->
              <!-- y: [16, 5, 11, 9], -->
              <!-- type: 'scatter' -->
            <!-- }], -->
            drawData : genPressureField(200,20000),
            gridNum : 200,
            gridRes : 20000,
            message:"Hi",
          }
        },
        mounted(){
          Plotly.newPlot(this.$refs.mydiv, this.drawData);
        },
        methods:{
          modifyData:function(){
            console.log(this.gridNum);
            console.log(this.gridRes);
            this.drawData = genPressureField(this.gridNum,this.gridRes)
            Plotly.newPlot(this.$refs.mydiv, this.drawData);
          }
          
        }
      });
      // mount
      vm.mount('#app');
    </script>        
  </body>
</html>